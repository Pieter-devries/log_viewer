(()=>{"use strict";const e={originalData:[],queryResponse:null,config:null,selectedFieldName:"all",showRowNumbers:!1,filterCaseSensitive:!1,highlightCaseSensitive:!1,isDragging:!1},n={visElement:null,filterInput:null,highlightInput:null,fieldSelectElement:null,logHeaderArea:null,logLinesArea:null,minimapContainer:null,minimapThumb:null,rowNumberCheckbox:null,clearFilterButton:null,clearHighlightButton:null,filterCaseChk:null,highlightCaseChk:null};function i(e,n,t){if(3===e.nodeType){const i=e.nodeValue;if(!i)return!1;const o=i.matchAll(n),l=Array.from(o);if(l.length>0){const n=document.createDocumentFragment();let o=0;for(const e of l){const l=e[0],r=e.index;if(void 0===r)continue;r>o&&n.appendChild(document.createTextNode(i.substring(o,r)));const a=document.createElement("span");a.className=t,a.textContent=l,n.appendChild(a),o=r+l.length}if(o<i.length&&n.appendChild(document.createTextNode(i.substring(o))),!e.parentNode)return console.warn("highlightNode: node.parentNode was null.",{node:e}),!1;try{e.parentNode.replaceChild(n,e)}catch(n){return console.error("highlightNode: Error during replaceChild:",n,{node:e,parent:e.parentNode}),!1}return!0}}else if(1===e.nodeType&&e.childNodes&&!/(script|style)/i.test(e.tagName)&&e.className!==t){const o=Array.from(e.childNodes);let l=!1;for(let e=0;e<o.length;e++)i(o[e],n,t)&&(l=!0);return l}return!1}function t(){if(!n.highlightInput||!n.logLinesArea||!n.minimapContainer)return void console.warn("applyHighlight: Missing required elements.");const t=n.highlightInput.value,o=n.logLinesArea.querySelectorAll(".log-line"),l=n.minimapContainer,r=n.logLinesArea,a="highlight-match";l.querySelectorAll(".minimap-marker").forEach((e=>e.remove()));const s="none"!==l.style.display,c=e.highlightCaseSensitive?"g":"gi",d=t?new RegExp((g=t)?g.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"):"",c):null;var g;const h=document.createDocumentFragment(),p=l.clientHeight,u=Math.max(1,r.scrollHeight);o.forEach(((e,n)=>{const t=e.dataset.originalHtml;if(void 0===t){const n=e.dataset.originalText||e.textContent||"";return void(d?e.innerHTML=n.replace(d,`<span class="${a}">$&</span>`):e.textContent=n)}e.innerHTML=t;let o=!1;if(d)try{o=i(e,d,a)}catch(i){console.error(`ApplyHighlight Error processing line ${n}:`,i);try{e.innerHTML=t}catch(e){console.error("ApplyHighlight: Failed to restore HTML after highlight error",e)}}if(s&&o&&p>0){const n=e.offsetTop/u,i=Math.max(0,Math.min(p-2,n*p));if(!isNaN(i)&&isFinite(i)){const e=document.createElement("div");e.className="minimap-marker",e.style.top=i+"px",h.appendChild(e)}}})),l.appendChild(h)}let o,l,r=null,a=null;function s(e,n,i,t){const o=i-t,l=n>0?e/n*o:0;return Math.max(0,Math.min(l,o))}function c(){if(!n.logLinesArea||!n.minimapContainer||!n.minimapThumb)return;const e=n.logLinesArea,i=n.minimapContainer,t=n.minimapThumb,o=i.clientHeight,l=e.scrollHeight,r=e.clientHeight;if(l<=r||o<=0)return t.style.opacity="0",t.style.height="0px",void(t.style.pointerEvents="none");const a=function(e,n,i){const t=e/n*i;return Math.max(20,t)}(r,l,o),c=l-r,d=s(Math.min(e.scrollTop,c),c,o,a);t.style.height=`${a}px`,t.style.top=`${d}px`,t.style.opacity="1",t.style.pointerEvents="auto"}function d(){e.isDragging||c()}function g(i){if(!(e.isDragging&&n.logLinesArea&&n.minimapContainer&&n.minimapThumb))return;i.preventDefault();const t=n.logLinesArea,o=n.minimapContainer,l=n.minimapThumb,r=o.clientHeight,a=t.scrollHeight,c=t.clientHeight,d=l.offsetHeight,g=o.getBoundingClientRect(),h=i.clientY-g.top,p=r-d,u=a-c;if(p<=0||u<0)return;const m=(h-d/2)/p*u,f=Math.max(0,Math.min(u,m));t.scrollTop=f;const v=s(f,u,r,d);l.style.top=`${v}px`}function h(i){e.isDragging&&(i.preventDefault(),e.isDragging=!1,n.minimapThumb&&n.minimapThumb.classList.remove("dragging"),r&&(window.removeEventListener("mousemove",r),r=null),a&&(window.removeEventListener("mouseup",a),a=null))}function p(i){if(!n.logLinesArea||!n.minimapContainer||!n.minimapThumb)return;i.preventDefault();const t=n.logLinesArea,o=n.minimapContainer,l=n.minimapThumb,s=o.clientHeight,d=t.scrollHeight,p=t.clientHeight;if(d<=p||s<=0)return;const u=o.getBoundingClientRect(),m=i.clientY-u.top,f=l.offsetHeight,v=s-f,b=d-p;if(v>0&&b>=0){const e=(m-f/2)/v*b;t.scrollTop=Math.max(0,Math.min(b,e)),c()}e.isDragging=!0,l.classList.add("dragging"),r&&window.removeEventListener("mousemove",r),a&&window.removeEventListener("mouseup",a),r=g,a=h,window.addEventListener("mousemove",r),window.addEventListener("mouseup",a)}function u(){if(!n.logHeaderArea||!n.logLinesArea)return;console.log("Applying dynamic column widths (fixed narrow)...");const e=n.logHeaderArea,i=n.logLinesArea,o=Array.from(e.children),l=Array.from(i.children),r=o.length;if(0===r||0===l.length)return void console.log("No header or line elements found to apply widths.");const a=[];console.time("Measure Column Widths");for(let e=0;e<r;e++){const n=o[e],i=n.classList.contains("log-header-cell")||n.classList.contains("log-row-num-header"),t=n.classList.contains("log-row-num-header"),s=n.classList.contains("log-header-separator");let c=n.scrollWidth,d=!0;const g=[n];for(let n=0;n<Math.min(l.length,100);n++){const t=l[n];if(t.children.length===r){const n=t.children[e];if(n&&(g.push(n),i)){const e=n.scrollWidth;c=Math.max(c,e),e>150&&(d=!1)}}else console.warn(`Row ${n} has ${t.children.length} children, expected ${r}. Skipping style application for this row.`)}s&&(c=Math.max(15,c),d=!0),t&&(c=45,d=!0),a[e]={element:n,elementsToStyle:g,isDataColumn:i,isNarrowCandidate:d,maxWidth:c}}console.timeEnd("Measure Column Widths"),console.time("Apply Column Styles"),a.forEach(((e,n)=>{let i="",t="",o="",l="",r="",a="";const s=e.isNarrowCandidate&&e.maxWidth<150,c=e.isDataColumn&&!s;!e.isDataColumn||s?(t=`${e.maxWidth}px`,i="none",o="nowrap",l="hidden",e.element.classList.contains("log-header-cell")&&(r="ellipsis"),(e.element.classList.contains("field-2")||e.element.classList.contains("field-3")||e.element.classList.contains("log-row-num-header"))&&(a="right")):(i="1 1 50px",o="",l="",e.element.classList.contains("log-header-cell")&&(o="nowrap",l="hidden",r="ellipsis")),e.elementsToStyle.forEach((e=>{e.style.flex=i,t?(e.style.width=t,e.style.minWidth=t):(e.style.width="",e.style.minWidth=""),e.style.whiteSpace=o||"",e.style.overflow=l||"",e.style.textOverflow=r||"",e.style.textAlign=a||"",c&&e.classList.contains("log-field")&&(e.style.overflow="visible",e.style.whiteSpace="pre-wrap",e.style.wordBreak="break-word",e.style.overflowWrap="break-word")}))})),console.timeEnd("Apply Column Styles"),requestAnimationFrame((()=>{console.log("Updating thumb and highlights after width sync."),c(),t()}))}function m(){if(console.log("RenderViz called (JS Fixed Width Sync)."),[n.visElement,n.logLinesArea,n.logHeaderArea,n.minimapContainer,n.minimapThumb,n.filterInput,n.highlightInput,n.fieldSelectElement,n.rowNumberCheckbox,n.filterCaseChk,n.highlightCaseChk].some((e=>!e))||!e.originalData||!e.queryResponse)return console.warn("RenderViz aborted: Missing critical elements or state data."),void(n.logLinesArea&&(n.logLinesArea.innerHTML='<p style="padding: 5px; color: orange;">Waiting for data or elements...</p>'));const i=n.logLinesArea,t=n.logHeaderArea,o=n.rowNumberCheckbox,l=n.filterCaseChk,r=n.highlightCaseChk;o.checked=e.showRowNumbers,l.checked=e.filterCaseSensitive,r.checked=e.highlightCaseSensitive;const a=[...e.queryResponse.fields.dimensions||[],...e.queryResponse.fields.measures||[]];if(0===a.length)return;const s=function(i){var t;if(!n.filterInput)return i;let o=n.filterInput.value;if(!o)return i;e.filterCaseSensitive||(o=o.toLowerCase());const l=e.selectedFieldName,r=(null===(t=e.queryResponse)||void 0===t?void 0:t.fields)?[...e.queryResponse.fields.dimensions||[],...e.queryResponse.fields.measures||[]]:[];if(0===r.length)return i;try{return i.filter((n=>{const i=i=>{var t;const l=n[i.name];let r=null===(t=null==l?void 0:l.value)||void 0===t?void 0:t.toString();return null!=r&&(e.filterCaseSensitive||(r=r.toLowerCase()),r.includes(o))};if("all"===l)return r.some(i);{const e=r.find((e=>e.name===l));return!!e&&i(e)}}))}catch(e){return console.error("Error during data filtering:",e),i}}(e.originalData);console.log(`RenderViz: Rendering ${s.length} rows out of ${e.originalData.length}.`),t.innerHTML="",i.innerHTML="";try{const o=function(n){const i=document.createDocumentFragment();if(e.showRowNumbers){const e=document.createElement("div");e.className="log-row-num-header",e.textContent="#",i.appendChild(e)}return n.forEach(((n,t)=>{if(t>0||e.showRowNumbers){const e=document.createElement("div");e.className="log-header-separator",e.textContent="|",i.appendChild(e)}const o=document.createElement("div"),l=n.is_measure?"measure":"dimension";o.className="log-header-cell",o.classList.add(`field-${t}`,`field-type-${l}`),o.textContent=n.label_short||n.label||n.name,o.title=n.label||n.name,i.appendChild(o)})),i}(a);if(t.appendChild(o),0===s.length){const e=document.createElement("p");e.style.color="orange",e.style.padding="5px",e.textContent=n.filterInput.value?"No logs match filter.":"Query returned no data.",i.appendChild(e),n.minimapContainer&&(n.minimapContainer.style.display="none")}else{const n=function(n,i){const t=document.createDocumentFragment(),o=new Map;return e.originalData.forEach(((e,n)=>o.set(e,n))),n.forEach((n=>{var l;const r=null!==(l=o.get(n))&&void 0!==l?l:-1,{element:a}=function(n,i,t){const o=document.createElement("div");o.className="log-line";let l=[];if(e.showRowNumbers){const e=document.createElement("span");e.className="log-row-num";const n=`${t+1}: `;e.textContent=n,o.appendChild(e),l.push(n)}i.forEach(((i,t)=>{var r,a;if(t>0||e.showRowNumbers){const e=document.createElement("span");e.className="log-field-separator",e.textContent=" | ",o.appendChild(e),l.push(" | ")}const s=document.createElement("span"),c=i.is_measure?"measure":"dimension";s.classList.add("log-field",`field-${t}`,`field-type-${c}`);const d=n[i.name];let g="[NULL]",h="[NULL]";if(null!=(null==d?void 0:d.value)){h=d.value.toString();try{g=null!==(a=null===(r=null===LookerCharts||void 0===LookerCharts?void 0:LookerCharts.Utils)||void 0===r?void 0:r.htmlForCell(d))&&void 0!==a?a:h}catch(e){g=h}}else(null==d?void 0:d.rendered)&&(h=d.rendered,g=d.rendered);s.innerHTML=g,l.push(h),(null==d?void 0:d.links)&&d.links.length>0&&(s.classList.add("drillable"),s.onclick=e=>{var n;"undefined"!=typeof LookerCharts&&(null===(n=LookerCharts.Utils)||void 0===n?void 0:n.openDrillMenu)?LookerCharts.Utils.openDrillMenu({links:d.links,event:e}):console.error("LookerCharts.Utils.openDrillMenu is not available.")}),o.appendChild(s)}));const r=l.join("");return o.dataset.originalText=r,o.dataset.originalHtml=o.innerHTML,{element:o,text:r}}(n,i,r);t.appendChild(a)})),t}(s,a);i.appendChild(n)}}catch(e){return}s.length>0||a.length>0?requestAnimationFrame(u):requestAnimationFrame((()=>{c()}))}function f(e){n.visElement=e,n.filterInput=e.querySelector("#log-filter-input"),n.highlightInput=e.querySelector("#log-highlight-input"),n.fieldSelectElement=e.querySelector("#log-field-select"),n.logHeaderArea=e.querySelector("#log-header-area"),n.logLinesArea=e.querySelector("#log-lines-area"),n.minimapContainer=e.querySelector("#minimap-container"),n.minimapThumb=e.querySelector("#minimap-thumb"),n.rowNumberCheckbox=e.querySelector("#show-row-numbers-chk"),n.clearFilterButton=e.querySelector("#clear-filter-btn"),n.clearHighlightButton=e.querySelector("#clear-highlight-btn"),n.filterCaseChk=e.querySelector("#filter-case-chk"),n.highlightCaseChk=e.querySelector("#highlight-case-chk");const i=!!(n.logLinesArea&&n.logHeaderArea&&n.rowNumberCheckbox&&n.filterInput&&n.highlightInput&&n.fieldSelectElement&&n.minimapContainer&&n.minimapThumb&&n.clearFilterButton&&n.clearHighlightButton&&n.filterCaseChk&&n.highlightCaseChk);return i||console.error("findElements: One or more critical elements NOT found!"),i}const v={id:"log-viewer-dev",label:"Log Viewer",options:{showRowNumbers:{type:"boolean",label:"Show Row Numbers",default:!1,section:"Display",order:1},filterCaseSensitive:{type:"boolean",label:"Case-Sensitive Filter",default:!1,section:"Filtering & Search",order:1},highlightCaseSensitive:{type:"boolean",label:"Case-Sensitive Search",default:!1,section:"Filtering & Search",order:3}},create:function(i,r){console.log("Log Viewer Vis: Create called");try{if(a=i,console.log("Setting up HTML structure with readability improvements"),a.innerHTML='\n      <style>\n      /* Base container */\n      .log-viewer-container {\n        background-color: black;\n        color: #ddd; /* Brighter base text color */\n        /* Modern monospace stack */\n        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;\n        font-size: 13px; /* Slightly larger base font size */\n        height: 100%;\n        position: relative;\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n      }\n      /* Controls area */\n      #controls-area { position: relative; z-index: 10; background-color: #1c1c1c; padding: 5px 8px; display: flex; flex-wrap: wrap; align-items: center; gap: 10px; border-bottom: 1px solid #444; margin-bottom: 0; }\n      .control-group { display: flex; align-items: center; gap: 4px; }\n      .control-group label { color: #aaa; font-size: 0.9em; white-space: nowrap; }\n      /* Ensure inputs inherit font */\n      .control-group input[type="text"], .control-group select { padding: 3px 5px; border: 1px solid #555; background-color: #333; color: #eee; font-size: inherit; font-family: inherit; border-radius: 3px; }\n      #row-number-toggle { order: -1; }\n      #row-number-toggle label { cursor: pointer; user-select: none; }\n      #row-number-toggle input[type="checkbox"] { cursor: pointer; margin-right: 3px; }\n      .input-wrapper { position: relative; display: inline-flex; align-items: center; }\n      .input-wrapper input[type="text"] { padding-right: 18px; }\n      .clear-button { position: absolute; right: 1px; top: 1px; bottom: 1px; border: none; background: transparent; color: #888; cursor: pointer; padding: 0 4px; font-size: 1.1em; line-height: 1; display: none; }\n      .input-wrapper input[type="text"]:not(:placeholder-shown) + .clear-button { display: inline-block; }\n      .clear-button:hover { color: #ccc; }\n      .case-sensitivity-toggle { display: flex; align-items: center; }\n      .case-sensitivity-toggle input[type="checkbox"] { cursor: pointer; margin-right: 3px;}\n      .case-sensitivity-toggle label { color: #aaa; font-size: 0.85em; cursor: pointer; user-select: none; }\n      /* Main Content Area */\n      .main-content-area { display: flex; flex-direction: column; flex-grow: 1; overflow: hidden; box-sizing: border-box; }\n\n      /* --- Fallback Flexbox Layout (Before JS Width Calculation) --- */\n\n      /* Header Area & Log Line Flex Containers */\n      #log-header-area, .log-line {\n        display: flex;\n        align-items: baseline;\n        box-sizing: border-box;\n        width: 100%;\n        flex-wrap: nowrap;\n      }\n      #log-header-area {\n        background-color: #1a1a1a; border-bottom: 1px solid #555; padding: 4px 5px;\n        flex-shrink: 0; color: #eee; /* Header text slightly brighter */ font-weight: bold; padding-right: 20px;\n        overflow: hidden;\n      }\n      .log-line {\n        margin: 0; padding: 2px 0; /* Padding applied to cells now */ border-bottom: 1px dotted #444; color: #ddd; /* Base text color */\n        /* font-size applied to container */\n      }\n\n      /* Default for cells/headers: Flexible, allow wrapping/truncating */\n      .log-header-cell, .log-field {\n        flex: 1 1 auto; /* Default: Grow, Shrink, Basis Auto */\n        min-width: 40px; /* Prevent complete collapse */\n        padding: 2px 5px; /* Increased padding */\n        box-sizing: border-box;\n        overflow: hidden; /* Hide overflow by default */\n      }\n      .log-header-cell {\n        white-space: nowrap;\n        text-overflow: ellipsis;\n      }\n      .log-field {\n        white-space: pre-wrap; /* Allow wrapping */\n        word-break: break-word;\n        overflow-wrap: break-word;\n        line-height: 1.5; /* Improved line spacing */\n        /* overflow: visible; */ /* Let JS control overflow */\n      }\n\n      /* Row Number: Fixed Width */\n      .log-row-num-header, .log-row-num {\n        flex: 0 0 45px; /* Fixed width */\n        min-width: 45px; /* Override default min-width */\n        padding: 2px 10px 2px 5px; /* Adjusted padding */\n        text-align: right;\n        white-space: nowrap;\n        color: #999; /* Dimmer color for row numbers */\n        user-select: none;\n        /* font-size: 0.9em; */ /* Inherit from container */\n      }\n      .log-row-num-header { color: #aaa; font-weight: normal; text-overflow: ellipsis; }\n\n      /* Separators: Auto Width */\n      .log-header-separator, .log-field-separator {\n        flex: 0 0 auto; /* Size based on content */\n        min-width: auto; /* Override default min-width */\n        padding: 2px 5px; /* Consistent padding */\n        color: #666; font-weight: normal;\n      }\n      /* --- End Fallback Flexbox Layout --- */\n\n\n      /* Log Scroll Container */\n      .log-scroll-container { display: flex; flex-grow: 1; overflow: hidden; }\n\n      /* Log Lines Area - HIDE SCROLLBAR */\n      #log-lines-area {\n        flex-grow: 1; overflow: auto; box-sizing: border-box; padding-right: 5px;\n        scrollbar-width: none; -ms-overflow-style: none;\n      }\n      #log-lines-area::-webkit-scrollbar { display: none; width: 0; height: 0; }\n\n      /* Minimap (unchanged) */\n      #minimap-container { position: relative; width: 15px; background-color: #222; border-left: 1px solid #444; display: none; box-sizing: border-box; flex-shrink: 0; cursor: pointer; user-select: none; }\n      #minimap-thumb { position: absolute; left: 1px; right: 1px; background-color: rgba(100, 100, 100, 0.5); border-radius: 2px; opacity: 0; transition: opacity 0.2s ease-in-out, background-color 0.2s ease-in-out; cursor: ns-resize; pointer-events: none; }\n      #minimap-thumb.dragging { background-color: rgba(150, 150, 150, 0.8); }\n      #minimap-container:hover #minimap-thumb { opacity: 1; background-color: rgba(150, 150, 150, 0.7); }\n      /* Highlight/Marker/Drillable styles */\n      .highlight-match { background-color: #550; color: #ff6; border-radius: 2px; padding: 0 1px; } /* Different highlight */\n      .minimap-marker { position: absolute; left: 1px; right: 1px; height: 2px; background-color: rgba(255, 255, 0, 0.7); pointer-events: none; border-radius: 1px; }\n      .drillable { cursor: pointer; text-decoration: underline; text-decoration-color: #66f; color: #9bf; } /* Brighter drill links */\n      .drillable:hover { text-decoration-color: #aaf; color: #aef; background-color: rgba(100, 100, 255, 0.1); }\n    </style>\n      <div class="log-viewer-container">\n        <div id="controls-area">\n          <div id="row-number-toggle" class="control-group"><input type="checkbox" id="show-row-numbers-chk" /><label for="show-row-numbers-chk">Row&nbsp;#</label></div>\n          <div class="control-group"><label for="log-field-select">Field:</label><select id="log-field-select"><option value="all">All Fields</option></select></div>\n          <div class="control-group"><label for="log-filter-input">Filter:</label><span class="input-wrapper"><input type="text" id="log-filter-input" placeholder="Filter rows..." /><button id="clear-filter-btn" class="clear-button" title="Clear filter">&times;</button></span><span class="case-sensitivity-toggle" title="Case sensitive filter"><input type="checkbox" id="filter-case-chk" /><label for="filter-case-chk">Aa</label></span></div>\n          <div class="control-group"><label for="log-highlight-input">Search:</label><span class="input-wrapper"><input type="text" id="log-highlight-input" placeholder="Highlight text..." /><button id="clear-highlight-btn" class="clear-button" title="Clear search">&times;</button></span><span class="case-sensitivity-toggle" title="Case sensitive search"><input type="checkbox" id="highlight-case-chk" /><label for="highlight-case-chk">Aa</label></span></div>\n        </div>\n        <div class="main-content-area">\n          <div id="log-header-area"></div>\n          <div class="log-scroll-container">\n             <div id="log-lines-area"></div>\n             <div id="minimap-container"><div id="minimap-thumb"></div></div>\n          </div>\n        </div>\n      </div>\n    ',!f(i))return console.error("Create: Failed to find critical elements."),void(i.innerHTML='<div style="color:red; padding:10px;">Error: Vis init failed (missing elements).</div>');!function(){if(console.log("Attaching event listeners"),[n.filterInput,n.clearFilterButton,n.filterCaseChk,n.highlightInput,n.clearHighlightButton,n.highlightCaseChk,n.logLinesArea,n.minimapContainer,n.fieldSelectElement,n.rowNumberCheckbox].some((e=>!e)))return void console.error("attachListeners: Cannot attach listeners, one or more required elements are missing.");const i=n.filterInput,r=n.clearFilterButton,a=n.filterCaseChk,s=n.highlightInput,c=n.clearHighlightButton,g=n.highlightCaseChk,h=n.logLinesArea,u=n.minimapContainer,f=n.fieldSelectElement,v=n.rowNumberCheckbox;i.addEventListener("input",(()=>{clearTimeout(o),o=window.setTimeout((()=>{console.log("Filter Debounce: Calling renderViz"),m()}),250)})),r.addEventListener("click",(()=>{i.value&&(i.value="",clearTimeout(o),console.log("Clear Filter: Calling renderViz immediately"),m())})),a.addEventListener("change",(n=>{e.filterCaseSensitive=n.target.checked,console.log("Filter Case Change: Calling renderViz"),m()})),s.addEventListener("input",(()=>{clearTimeout(l),l=window.setTimeout((()=>{console.log("Highlight Debounce: Calling applyHighlight"),t()}),150)})),c.addEventListener("click",(()=>{s.value&&(s.value="",clearTimeout(l),console.log("Clear Highlight: Calling applyHighlight immediately"),t())})),g.addEventListener("change",(n=>{e.highlightCaseSensitive=n.target.checked,console.log("Highlight Case Change: Calling applyHighlight"),t()})),h.addEventListener("scroll",d,{passive:!0}),u.addEventListener("mousedown",p),f.addEventListener("change",(n=>{e.selectedFieldName=n.target.value,console.log(`Field Selection Change: New field is "${e.selectedFieldName}". Calling renderViz.`),m()})),v.addEventListener("change",(n=>{e.showRowNumbers=n.target.checked,console.log(`Row Number Toggle Change: Show is ${e.showRowNumbers}. Calling renderViz.`),m()})),console.log("Event listeners attached successfully.")}(),console.log("Log Viewer Vis: Create finished successfully.")}catch(e){console.error("Error during visualization creation:",e),i.innerHTML=`<div style="color:red; padding:10px;">Error: Vis init failed. ${e instanceof Error?e.message:String(e)}</div>`}var a},updateAsync:function(i,t,o,l,r,a){console.log("Log Viewer Vis: updateAsync called");try{if(s=i,c=l,d=o,console.log("Updating core state with new data and config:",d),e.originalData=s||[],e.queryResponse=c,e.config=d,e.showRowNumbers=null!==(g=null==d?void 0:d.showRowNumbers)&&void 0!==g&&g,e.filterCaseSensitive=null!==(h=null==d?void 0:d.filterCaseSensitive)&&void 0!==h&&h,e.highlightCaseSensitive=null!==(p=null==d?void 0:d.highlightCaseSensitive)&&void 0!==p&&p,console.log("Core state after update:",{showRowNumbers:e.showRowNumbers,filterCaseSensitive:e.filterCaseSensitive,highlightCaseSensitive:e.highlightCaseSensitive,dataLength:e.originalData.length}),console.log("Log Viewer Vis: Core state updated with config:",o),!f(t))return console.error("updateAsync: Failed to find critical elements during update."),n.logLinesArea?n.logLinesArea.innerHTML='<p style="color:red; padding:10px;">Error: Vis update failed (missing elements).</p>':t.innerHTML='<div style="color:red; padding:10px;">Error: Vis update failed (missing elements).</div>',void a();(null==l?void 0:l.fields)?b(l.fields.dimensions||[],l.fields.measures||[]):(console.warn("updateAsync: queryResponse.fields is missing or empty."),b([],[])),m(),console.log("Log Viewer Vis: renderViz called after state update.")}catch(e){console.error("Error during visualization update:",e),n.logLinesArea?n.logLinesArea.innerHTML=`<p style="color:red; padding:10px;">Error: Vis update failed. ${e instanceof Error?e.message:String(e)}</p>`:t.innerHTML=`<div style="color:red; padding:10px;">Error: Vis update failed. ${e instanceof Error?e.message:String(e)}</div>`}finally{console.log("Log Viewer Vis: updateAsync finished."),a()}var s,c,d,g,h,p}};function b(i,t){if(!n.fieldSelectElement)return void console.error("updateFieldDropdown: fieldSelectElement is null.");const o=n.fieldSelectElement,l=e.selectedFieldName;o.innerHTML="";const r=document.createElement("option");r.value="all",r.textContent="All Fields",o.appendChild(r);const a=[...i||[],...t||[]];a.forEach((e=>{if(!e||!e.name)return;const n=document.createElement("option");n.value=e.name,n.textContent=e.label_short||e.label||e.name,o.appendChild(n)}));const s=a.some((e=>e.name===l))?l:"all";o.value=s,e.selectedFieldName!==s&&(console.log(`updateFieldDropdown: Selected field changed from "${l}" to "${s}"`),e.selectedFieldName=s)}looker.plugins.visualizations.add(v)})();