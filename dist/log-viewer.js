(()=>{"use strict";const e={originalData:[],queryResponse:null,config:null,selectedFieldName:"all",showRowNumbers:!1,filterCaseSensitive:!1,highlightCaseSensitive:!1,isDragging:!1},n={visElement:null,filterInput:null,highlightInput:null,fieldSelectElement:null,logHeaderArea:null,logLinesArea:null,minimapContainer:null,minimapThumb:null,rowNumberCheckbox:null,clearFilterButton:null,clearHighlightButton:null,filterCaseChk:null,highlightCaseChk:null};function i(e,n,t){if(3===e.nodeType){const i=e.nodeValue;if(!i)return!1;const l=i.matchAll(n),r=Array.from(l);if(r.length>0){const n=document.createDocumentFragment();let l=0;for(const e of r){const r=e[0],o=e.index;if(void 0===o)continue;o>l&&n.appendChild(document.createTextNode(i.substring(l,o)));const a=document.createElement("span");a.className=t,a.textContent=r,n.appendChild(a),l=o+r.length}if(l<i.length&&n.appendChild(document.createTextNode(i.substring(l))),!e.parentNode)return console.warn("highlightNode: node.parentNode was null.",{node:e}),!1;try{e.parentNode.replaceChild(n,e)}catch(n){return console.error("highlightNode: Error during replaceChild:",n,{node:e,parent:e.parentNode}),!1}return!0}}else if(1===e.nodeType&&e.childNodes&&!/(script|style)/i.test(e.tagName)&&e.className!==t){const l=Array.from(e.childNodes);let r=!1;for(let e=0;e<l.length;e++)i(l[e],n,t)&&(r=!0);return r}return!1}function t(){if(!n.highlightInput||!n.logLinesArea||!n.minimapContainer)return void console.warn("applyHighlight: Missing required elements.");const t=n.highlightInput.value,l=n.logLinesArea.querySelectorAll(".log-line"),r=n.minimapContainer,o=n.logLinesArea,a="highlight-match";r.querySelectorAll(".minimap-marker").forEach((e=>e.remove()));const s="none"!==r.style.display,c=e.highlightCaseSensitive?"g":"gi",d=t?new RegExp((p=t)?p.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"):"",c):null;var p;const g=document.createDocumentFragment(),h=r.clientHeight,u=Math.max(1,o.scrollHeight);l.forEach(((e,n)=>{const t=e.dataset.originalHtml;if(void 0===t){const n=e.dataset.originalText||e.textContent||"";return void(d?e.innerHTML=n.replace(d,`<span class="${a}">$&</span>`):e.textContent=n)}e.innerHTML=t;let l=!1;if(d)try{l=i(e,d,a)}catch(i){console.error(`ApplyHighlight Error processing line ${n}:`,i);try{e.innerHTML=t}catch(e){console.error("ApplyHighlight: Failed to restore HTML after highlight error",e)}}if(s&&l&&h>0){const n=e.offsetTop/u,i=Math.max(0,Math.min(h-2,n*h));if(!isNaN(i)&&isFinite(i)){const e=document.createElement("div");e.className="minimap-marker",e.style.top=i+"px",g.appendChild(e)}}})),r.appendChild(g)}function l(){if(!n.logLinesArea||!n.minimapContainer||!n.minimapThumb)return;const e=n.logLinesArea,i=n.minimapContainer.clientHeight,t=e.scrollHeight,l=e.clientHeight;if(t<=l||i<=0)return n.minimapThumb.style.opacity="0",void(n.minimapThumb.style.height="0px");const r=Math.max(20,l/t*i),o=t-l,a=Math.min(e.scrollTop,o),s=o>0?a/o*(i-r):0,c=Math.max(0,Math.min(s,i-r));n.minimapThumb.style.height=`${r}px`,n.minimapThumb.style.top=`${c}px`,n.minimapThumb.style.opacity="1"}function r(){e.isDragging||l()}function o(e){if(!n.logLinesArea||!n.minimapContainer||!n.minimapThumb)return;e.preventDefault();const i=n.logLinesArea,t=n.minimapContainer.clientHeight,r=i.scrollHeight,o=i.clientHeight;if(r<=o||t<=0)return;const a=n.minimapContainer.getBoundingClientRect(),s=e.clientY-a.top,c=n.minimapThumb.offsetHeight,d=t-c,p=r-o;if(d>0&&p>0){const e=(s-c/2)/d*p;i.scrollTop=Math.max(0,Math.min(p,e)),l()}}function a(){if(console.log("RenderViz called"),!(n.visElement&&e.originalData&&e.queryResponse&&n.filterInput&&n.logLinesArea&&n.logHeaderArea&&n.minimapContainer&&n.fieldSelectElement&&n.rowNumberCheckbox&&n.highlightInput&&n.minimapThumb))return void console.warn("RenderViz aborted: Missing critical elements or state data");const i=e.originalData,r=e.queryResponse,o=n.filterInput,a=n.logLinesArea,s=n.logHeaderArea,c=(n.minimapContainer,e.selectedFieldName),d=e.showRowNumbers,p=[...r.fields.dimensions||[],...r.fields.measures||[]];if(console.log("RenderViz: Fields to Render:",p.map((e=>e.name))),0===p.length)return a.innerHTML='<p style="padding: 5px; color: orange;">Query returned no fields to display.</p>',void(s.innerHTML="");let g,h=o.value;e.filterCaseSensitive||(h=h.toLowerCase());const u=p;if(h)try{g=i.filter((n=>{const i=i=>{var t;const l=n[i.name];let r=null===(t=null==l?void 0:l.value)||void 0===t?void 0:t.toString();return null!=r&&(e.filterCaseSensitive||(r=r.toLowerCase()),r.includes(h))};if("all"===c)return u.some(i);{const e=u.find((e=>e.name===c));return!!e&&i(e)}}))}catch(e){console.error("Filter error:",e),g=i}else g=i;console.log(`RenderViz: Rendering ${g?g.length:0} rows.`),s.innerHTML="";try{const e=document.createDocumentFragment();if(d){const n=document.createElement("div");n.className="log-header-cell log-row-num-header",n.textContent="#",e.appendChild(n)}p.forEach(((n,i)=>{if(i>0){const n=document.createElement("div");n.className="log-header-separator",n.textContent="|",e.appendChild(n)}const t=document.createElement("div"),l=n.is_measure?"measure":"dimension";t.className="log-header-cell",t.classList.add(`field-${i}`,`field-type-${l}`),t.textContent=n.label_short||n.label||n.name,e.appendChild(t)})),s.appendChild(e)}catch(e){console.error("RenderViz: Error populating headers:",e),s.innerHTML='<div style="color: red; padding: 2px 5px;">Error loading headers</div>'}if(a.innerHTML="",g&&0!==g.length)try{const e=document.createDocumentFragment();g.forEach(((n,i)=>{const t=document.createElement("div");t.className="log-line";let l=[];if(d){const e=document.createElement("span");e.className="log-row-num";const n=`${i+1}: `;e.textContent=n,t.appendChild(e),l.push(n)}p.forEach(((e,i)=>{if(i>0){const e=document.createElement("span");e.className="log-field-separator",e.textContent=" | ",t.appendChild(e),l.push(" | ")}const r=document.createElement("span"),o=e.is_measure?"measure":"dimension";r.classList.add("log-field",`field-${i}`,`field-type-${o}`);const a=n[e.name],s=null!=(null==a?void 0:a.value)?LookerCharts.Utils.htmlForCell(a):"[NULL]";r.innerHTML=s,l.push(null!=(null==a?void 0:a.value)?a.value.toString():"[NULL]"),a&&a.links&&(r.classList.add("drillable"),r.onclick=e=>{LookerCharts.Utils.openDrillMenu({links:a.links,event:e})}),t.appendChild(r)})),t.dataset.originalText=l.join(""),t.dataset.originalHtml=t.innerHTML,e.appendChild(t)})),a.appendChild(e)}catch(e){console.error("RenderViz: Error during rendering loop:",e),a.innerHTML='<p style="color: red; padding: 5px;">Error rendering data.</p>'}else{const e=document.createElement("p");e.style.color="orange",e.style.padding="5px",e.textContent=h?"No logs match filter.":"Query returned no data.",a.appendChild(e)}requestAnimationFrame((()=>{n.logLinesArea&&n.minimapContainer&&(n.logLinesArea.scrollHeight>n.logLinesArea.clientHeight?(n.minimapContainer.style.display="block",l(),t()):(n.minimapContainer.style.display="none",t()))}))}function s(e){console.log("findElements called"),n.visElement=e,n.filterInput=e.querySelector("#log-filter-input"),n.highlightInput=e.querySelector("#log-highlight-input"),n.fieldSelectElement=e.querySelector("#log-field-select"),n.logHeaderArea=e.querySelector("#log-header-area"),n.logLinesArea=e.querySelector("#log-lines-area"),n.minimapContainer=e.querySelector("#minimap-container"),n.minimapThumb=e.querySelector("#minimap-thumb"),n.rowNumberCheckbox=e.querySelector("#show-row-numbers-chk"),n.clearFilterButton=e.querySelector("#clear-filter-btn"),n.clearHighlightButton=e.querySelector("#clear-highlight-btn"),n.filterCaseChk=e.querySelector("#filter-case-chk"),n.highlightCaseChk=e.querySelector("#highlight-case-chk");const i=!!(n.logLinesArea&&n.logHeaderArea&&n.rowNumberCheckbox&&n.filterInput&&n.highlightInput&&n.fieldSelectElement&&n.minimapContainer&&n.minimapThumb&&n.clearFilterButton&&n.clearHighlightButton&&n.filterCaseChk&&n.highlightCaseChk);return console.log("findElements: Critical elements found:",i),i||console.error("findElements: One or more critical elements NOT found!"),i}const c={id:"log-viewer-dev",label:"Log Viewer (Dev)",options:{},create:function(i,l){console.log("Log Viewer Vis (Dev): Create called (main.ts)");try{if(c=i,console.log("Setting up HTML structure"),c.innerHTML='\n      <style>\n      /* Base container */\n      .log-viewer-container { background-color: black; color: #ccc; font-family: Menlo, Monaco, Consolas, "Courier New", monospace; height: 100%; position: relative; display: flex; flex-direction: column; overflow: hidden; }\n      /* Controls area */\n      #controls-area { position: relative; z-index: 10; background-color: #1c1c1c; padding: 5px 8px; display: flex; flex-wrap: wrap; align-items: center; gap: 10px; border-bottom: 1px solid #444; margin-bottom: 0; }\n      .control-group { display: flex; align-items: center; gap: 4px; }\n      .control-group label { color: #aaa; font-size: 0.9em; white-space: nowrap; }\n      .control-group input[type="text"], .control-group select { padding: 3px 5px; border: 1px solid #555; background-color: #333; color: #eee; font-size: 0.9em; }\n      #row-number-toggle { order: -1; margin-right: 10px;}\n      #row-number-toggle label { cursor: pointer; }\n      #row-number-toggle input[type="checkbox"] { cursor: pointer; }\n      .input-wrapper { position: relative; display: inline-block; }\n      .input-wrapper input[type="text"] { padding-right: 18px; }\n      .clear-button { position: absolute; right: 1px; top: 1px; bottom: 1px; border: none; background: transparent; color: #888; cursor: pointer; padding: 0 4px; font-size: 1.1em; line-height: 1; display: none; }\n      .input-wrapper input[type="text"]:not(:placeholder-shown) + .clear-button { display: inline-block; }\n      .clear-button:hover { color: #ccc; }\n      .case-sensitivity-toggle { display: flex; align-items: center; margin-left: -6px; }\n      .case-sensitivity-toggle input[type="checkbox"] { cursor: pointer; margin-right: 3px;}\n      .case-sensitivity-toggle label { color: #aaa; font-size: 0.85em; cursor: pointer; }\n      /* Main Content Area */\n      .main-content-area { display: flex; flex-direction: column; flex-grow: 1; overflow: hidden; box-sizing: border-box; }\n      /* Header Area */\n      #log-header-area { display: flex; align-items: baseline; background-color: #1a1a1a; border-bottom: 1px solid #555; padding: 4px 5px; flex-shrink: 0; color: #ddd; font-weight: bold; padding-right: 20px; box-sizing: border-box; }\n      .log-header-cell { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; min-width: 0; padding: 0; }\n      .log-row-num-header { flex-shrink: 0; margin-right: 8px; color: #aaa; user-select: none; font-weight: normal; }\n      .log-header-cell.field-0 { flex-shrink: 0; }\n      .log-header-separator { margin: 0 5px; color: #666; flex-shrink: 0; font-weight: normal; }\n      /* Log Scroll Container */\n      .log-scroll-container { display: flex; flex-grow: 1; overflow: hidden; }\n      #log-lines-area { flex-grow: 1; overflow: auto; box-sizing: border-box; }\n      #log-lines-area::-webkit-scrollbar { width: 0px; height: 8px; }\n      #log-lines-area::-webkit-scrollbar-thumb:horizontal { background: #555; border-radius: 4px; }\n      #log-lines-area::-webkit-scrollbar-track:horizontal { background: #222; }\n      /* Minimap */\n      #minimap-container { position: relative; width: 15px; background-color: #222; border-left: 1px solid #444; display: none; box-sizing: border-box; flex-shrink: 0; cursor: pointer; user-select: none; }\n      #minimap-thumb { position: absolute; left: 1px; right: 1px; background-color: rgba(100, 100, 100, 0.5); border-radius: 2px; opacity: 0; transition: opacity 0.2s ease-in-out, background-color 0.2s ease-in-out; cursor: ns-resize; }\n      #minimap-container:hover #minimap-thumb, #minimap-thumb.dragging { opacity: 1; background-color: rgba(150, 150, 150, 0.7); }\n      /* Log Line styles */\n      .log-line { display: flex; align-items: baseline; margin: 0; padding: 2px 5px; border-bottom: 1px dotted #444; color: #ccc; box-sizing: border-box; }\n      .log-row-num { flex-shrink: 0; margin-right: 8px; color: #888; user-select: none; }\n      .log-field { white-space: pre-wrap; word-break: break-all; min-width: 0; }\n      .log-field.field-0 { flex-shrink: 0; }\n      .field-type-measure { /* Optional */ }\n      .log-field-separator { margin: 0 5px; color: #666; flex-shrink: 0; }\n      .highlight-match { background-color: yellow; color: black; }\n      .minimap-marker { position: absolute; left: 1px; right: 1px; height: 2px; background-color: yellow; opacity: 0.7; pointer-events: none; border-radius: 1px; }\n      .drillable { cursor: pointer; text-decoration: underline; text-decoration-color: #555; }\n      .drillable:hover { text-decoration-color: #999; background-color: rgba(255, 255, 255, 0.05); }\n    </style>\n      <div class="log-viewer-container">\n        <div id="controls-area">\n          <div id="row-number-toggle"><input type="checkbox" id="show-row-numbers-chk" /><label for="show-row-numbers-chk">Show Row #</label></div>\n          <div class="control-group">\n             <label for="log-field-select">Field:</label>\n             <select id="log-field-select"><option value="all">All Fields</option></select>\n          </div>\n          <div class="control-group">\n             <label for="log-filter-input">Filter:</label>\n             <span class="input-wrapper">\n                <input type="text" id="log-filter-input" placeholder="Filter rows..." />\n                <button id="clear-filter-btn" class="clear-button" title="Clear filter">&times;</button>\n             </span>\n             <span class="case-sensitivity-toggle">\n                <input type="checkbox" id="filter-case-chk" title="Case sensitive filter"/>\n                <label for="filter-case-chk">Aa</label>\n             </span>\n          </div>\n          <div class="control-group">\n             <label for="log-highlight-input">Search:</label>\n             <span class="input-wrapper">\n                <input type="text" id="log-highlight-input" placeholder="Highlight text..." />\n                <button id="clear-highlight-btn" class="clear-button" title="Clear search">&times;</button>\n             </span>\n              <span class="case-sensitivity-toggle">\n                <input type="checkbox" id="highlight-case-chk" title="Case sensitive search"/>\n                <label for="highlight-case-chk">Aa</label>\n             </span>\n          </div>\n        </div>\n        <div class="main-content-area">\n          <div id="log-header-area"></div>\n          <div class="log-scroll-container">\n             <div id="log-lines-area"> <p style="padding: 5px;">Log Viewer Initializing...</p> </div>\n             <div id="minimap-container"> <div id="minimap-thumb"></div> </div>\n          </div>\n        </div>\n      </div>\n    ',!s(i))return console.error("Create: Failed to find critical elements."),void(i.innerHTML='<div style="color:red; padding:10px;">Error: Vis init failed (missing elements).</div>');!function(){if(console.log("Attaching event listeners"),!(n.filterInput&&n.clearFilterButton&&n.filterCaseChk&&n.highlightInput&&n.clearHighlightButton&&n.highlightCaseChk&&n.logLinesArea&&n.minimapContainer&&n.fieldSelectElement&&n.rowNumberCheckbox))return void console.error("attachListeners: Cannot attach listeners, some elements are missing.");let i;n.filterInput.addEventListener("input",a),n.clearFilterButton.addEventListener("click",(()=>{n.filterInput&&n.filterInput.value&&(n.filterInput.value="",a())})),n.filterCaseChk.addEventListener("change",(n=>{e.filterCaseSensitive=n.target.checked,a()})),n.highlightInput.addEventListener("input",(()=>{clearTimeout(i),i=window.setTimeout(t,100)})),n.clearHighlightButton.addEventListener("click",(()=>{n.highlightInput&&n.highlightInput.value&&(n.highlightInput.value="",t())})),n.highlightCaseChk.addEventListener("change",(n=>{e.highlightCaseSensitive=n.target.checked,t()})),n.logLinesArea.addEventListener("scroll",r,{passive:!0}),n.minimapContainer.addEventListener("mousedown",o),n.fieldSelectElement.addEventListener("change",(n=>{e.selectedFieldName=n.target.value,a()})),n.rowNumberCheckbox.addEventListener("change",(n=>{e.showRowNumbers=n.target.checked,a()})),console.log("Event listeners attached.")}()}catch(e){console.error("Error during visualization creation:",e),i.innerHTML=`<div style="color:red; padding:10px;">Error: Vis init failed. ${e instanceof Error?e.message:"Unknown error"}</div>`}var c},updateAsync:function(i,t,l,r,o,c){console.log("Log Viewer Vis (Dev): updateAsync called (main.ts)");try{if(d=i,p=r,g=l,console.log("Updating core state"),e.originalData=d,e.queryResponse=p,e.config=g,!s(t))return console.error("updateAsync: Failed to find critical elements during update."),t.innerHTML='<div style="color:red; padding:10px;">Error: Vis update failed (missing elements).</div>',void c();n.rowNumberCheckbox&&(n.rowNumberCheckbox.checked=e.showRowNumbers),n.filterCaseChk&&(n.filterCaseChk.checked=e.filterCaseSensitive),n.highlightCaseChk&&(n.highlightCaseChk.checked=e.highlightCaseSensitive),r.fields?function(i,t){if(!n.fieldSelectElement)return void console.error("updateFieldDropdown: fieldSelectElement is null.");const l=n.fieldSelectElement,r=e.selectedFieldName;l.innerHTML="";const o=document.createElement("option");o.value="all",o.textContent="All Fields",l.appendChild(o),[...i,...t].forEach((e=>{const n=document.createElement("option");n.value=e.name,n.textContent=e.label_short||e.label||e.name,l.appendChild(n)}));const a=Array.from(l.options).some((e=>e.value===r));l.value=a?r:"all",e.selectedFieldName=l.value}(r.fields.dimensions,r.fields.measures):console.warn("updateAsync: queryResponse.fields is undefined during update."),a()}catch(e){console.error("Error during visualization update:",e),t.innerHTML=`<div style="color:red; padding:10px;">Error: Vis update failed. ${e instanceof Error?e.message:"Unknown error"}</div>`}finally{c()}var d,p,g}};looker.plugins.visualizations.add(c)})();